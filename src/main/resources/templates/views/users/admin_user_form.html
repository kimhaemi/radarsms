<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="layout/default_layout"
      th:with="metaTitle='사용자 생성/삭제'">

    <th:block layout:fragment="content">
        <script th:inline="javascript">
            /* <![CDATA[ */
            $(document).ready(function (){
                
                var mData = /*[[${list.memberData}]]*/;
                console.log(mData);
                
                if(mData != null){
                    $("#memberId").val(mData.memberId);
                    $("#memberClass").val(mData.memberClass).prop("selected", true); //사용자 등급
                    $("#memberName").val(mData.memberName);
                    $('#uid').val(mData.id);
                }
            
            });
            /* ]]> */


        </script>
        <script type="text/javascript">
            $(function() {
                $('a.btn').button();
            });

            function fnGoList(){
                location.href="/users/admin_user";
            }

            function fnUserDel(){
                if(confirm("사용자를 삭제하시겠습니까?")){
                    location.href="/users/admin_user_del?id="+$("#uid").val();
                }
            }

            function fnSubmit(){
                return false;
            }

            function fnSave(mode){
                console.log(mode);
                var text = "";
                if($('#memberId').val() == ""){
                    alert("사용자ID를 입력하세요.");
                    return false;
                }
                if($('#password').val() == ""){
                    alert("사용자 비밀번호를 입력하세요.");
                    return false;
                }
                if($('#password2').val() == ""){
                    alert("사용자 비밀번호 확인을 입력하세요.");
                    return false;
                }
                if($('#password').val() != $('#password2').val()){
                    alert("사용자 비밀번호를 확인하세요.");
                    return false;
                }
                if($('#memberName').val() == ""){
                    alert("사용자 이름을 입력하세요.");
                    return false;
                }

                if(mode == 'add'){ text = "사용자를 등록하시겠습니까?" }
                if(mode == 'modify'){ text = "사용자를 수정하시겠습니까?" }
                
                if(confirm(text)){
                    var url = '/users/admin_user_'+mode;
                    // location.href="/users/admin_user_"+mode+"?id="+$("#uid").val();
                    $.ajax({
                        type : 'post',           // 타입 (get, post, put 등등)
                        url : url,           // 요청할 서버url
                        async : true,            // 비동기화 여부 (default : true)
                        headers : {              // Http header
                        "Content-Type" : "application/json",
                        "X-HTTP-Method-Override" : "POST"
                        },
                        dataType : 'json',       // 데이터 타입 (html, xml, json, text 등등)
                        data : JSON.stringify({  // 보낼 데이터 (Object , String, Array)
                            "id" : $('#uid').val()
                        }),
                        success : function(result) { // 결과 성공 콜백함수
                            console.log(result);
                        },
                        error : function(request, status, error) { // 결과 에러 콜백함수
                            console.log(error)
                        }
                    });
                }
            }

        </script>

        <div id="contentMain">
            <table class="noticeTbl searchSeries">
                <thead>
                <tr>
                    <th class="left">
                        관리 &gt; 새로운 사용자
                    </th>
                    <th class="right">
                    </th>
                </tr>
                </thead>
            </table>
            
            <!-- <form id="userForm" modelattribute="userForm" action="/users/admin_user_add" method="post" target="_self"> -->
            <form id="userForm" modelattribute="userForm" action="" method="post" target="_self"></form>
            <input type="hidden" name="mode" value="I">
            <table class="mainTbl searchSeries" summary="">
                <caption class="hidden">관리자 정보 수정</caption>
                <colgroup>
                    <col style="width:300px;">
                    <col>
                </colgroup>
                <thead>
                    <tr>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <th>사용자 ID<i class="fa fa-asterisk required_ico"></i></th>
                        <td><input id="memberId" name="memberId" class="user_input" type="text" value="123">
                            <input id="uid" name="uid" type="hidden" value="">
                        </td>
                    </tr>
                    <tr>
                        <th>비밀번호<i class="fa fa-asterisk required_ico"></i></th>
                        <td>
                            <input id="password" name="password" class="user_input" type="password" value="">
                            <span></span>
                        </td>
                    </tr>
                    <tr>
                        <th>비밀번호 확인<i class="fa fa-asterisk required_ico"></i></th>
                        <td><input id="password2" name="password2" class="user_input" type="password" value=""></td>
                    </tr>
                    <tr>
                        <th>사용자 등급<i class="fa fa-asterisk required_ico"></i></th>
                        <td>
                            <select id="memberClass" name="memberClass" class="user_input">
                                <option value="U">사용자</option>
                                <option value="A">관리자</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <th>성명<i class="fa fa-asterisk required_ico"></i></th>
                        <td><input id="memberName" name="memberName" class="user_input" type="text" value=""></td>
                    </tr>
                    <tr>
                        <th>직책</th>
                        <td><input id="pos" name="pos" class="user_input" type="text" value=""></td>
                    </tr>
                    <tr>
                        <th>부서</th>
                        <td><input id="dept" name="dept" class="user_input" type="text" value=""></td>
                    </tr>
                    <tr>
                        <th>소속</th>
                        <td><input id="org" name="org" class="user_input" type="text" value=""></td>
                    </tr>
                    <tr>
                        <th>연락처</th>
                        <td><input id="phone" name="phone" class="user_input" type="text" value=""></td>
                    </tr>
                    <tr>
                        <th>E-Mail</th>
                        <td><input id="email" name="email" class="user_input" type="text" value=""></td>
                    </tr>
                    <tr>
                        <td colspan="2">
                            <!-- <input type="submit" class="login_btn submit" value="생 성">
                            <input type="reset" class="login_btn" value="다시 입력">
                            <input type="button" class="login_btn" value="리스트" onclick="fnGoList();return false;"> -->
                            <input type="submit" th:if="${list.memberData == null}" id="insert" class="btn login_btn submit" value="생 성" onclick="fnSave('add')" >
                            <input type="submit" th:if="${list.memberData != null}" id="update" class="btn login_btn submit" value="수 정" onclick="fnSave('modify')" >
                            <input type="reset"  id="reset"  class="btn login_btn"        value="다시 입력">
                            <input type="submit" th:if="${list.memberData != null}" id="delete" class="btn login_btn del"    value="삭 제" onclick="fnUserDel()">
                            <input type="button" id="list"   class="btn login_btn"        value="리스트" onclick="fnGoList();return false;">
                        </td>
                    </tr>
                </tbody>
            </table>
            </form>
        </div>


    </th:block>
</html>