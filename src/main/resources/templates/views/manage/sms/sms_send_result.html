<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="layout/default_layout"
      th:with="metaTitle='전체 감시'">

	<th:block layout:fragment="content">
        <script th:inline="javascript">
            /* <![CDATA[ */
                var mData = /*[[${list.smsRsultList}]]*/;
                console.log(mData);
            /* ]]> */
        </script>
        <style type="text/css">
        div.paginate a {
            font-weight : normal;
            margin : 0px 4px;
        }
        div.paginate span {
            margin : 0px 10px;
        }
        div.paginate a.choice {
            font-weight : bold;
            text-decoration: underline;
        }
        /* div.paginate a.first {
            
        }
        div.paginate a.prev {
            
        }
        div.paginate a.next {
            
        }
        div.paginate a.last {
            
        } */
        </style>

        <script type="text/javascript">
        function goPage(p){
            location.href = "?p=" + p;
        }
        $(function() {
            $('a.btn').button();
        });
        /* 
        * 
        * 같은 값이 있는 열을 병합함
        * 
        * 사용법 : $('#테이블 ID').rowspan(0);
        * 
        */     
        $.fn.rowspan = function(colIdx, isStats) {       
            return this.each(function(){      
                var that;     
                $('tr', this).each(function(row) {      
                    $('td:eq('+colIdx+')', this).filter(':visible').each(function(col) {
                        
                        if ($(this).html() == $(that).html()
                            && (!isStats 
                                    || isStats && $(this).prev().html() == $(that).prev().html()
                                    )
                            ) {            
                            rowspan = $(that).attr("rowspan") || 1;
                            rowspan = Number(rowspan)+1;
        
                            $(that).attr("rowspan",rowspan);
                            
                            // do your action for the colspan cell here            
                            $(this).hide();
                            
                            //$(this).remove(); 
                            // do your action for the old cell here
                            
                        } else {            
                            that = this;         
                        }          
                        
                        // set the that if not already set
                        that = (that == null) ? this : that;      
                    });     
                });    
            });  
        }; 
        $(document).ready(function() {
            $("#smsSendTab").rowspan(1);
            $("#smsSendTab").rowspan(3);
            $("#smsSendTab").rowspan(4);
            $("#smsSendTab").rowspan(6);
        });
        </script>
    
        <table class="noticeTbl settingSeries">
            <thead>
            <tr>
                <th class="left">
                    관리 &gt; 문자 발송 대기 내역 
                </th>
                <th class="right">
                    <form action="/manage/sms_send" method="get">
                        <input type="submit" value="문자 보내기">
                    </form>
                </th>
            </tr>
            </thead>
        </table>
        
        <table class="mainTbl settingSeries" summary="" id="smsSendTab">
            <caption class="hidden">문자 발송 대기 내역</caption>
            <thead>
                <tr>
                    <th>순번</th>
                    <th>문자 종류</th>
                    <th>발송 번호</th>
                    <th>발송 상태</th>
                    <th>발신 요청 시각</th>
                    <th>수신 전화번호</th>
                    <th>발신 메시지</th>
                </tr>
            </thead>
            <tbody>
                  <tr th:each="smsList, smsListStat : ${list.smsRsultList}">
                    <td><span th:text="${smsListStat.index+1}"></span></td>
                    <td><span th:text="${smsList.TYPE}"></span></td>
                    <td><span th:text="${smsList.MSGKEY}"></span></td>
                    <td th:switch="${smsList.STATUS}">
                        <label th:case="0">전송대기</label>
                        <label th:case="1">전송완료</label>
                        <label th:case="2" th:if="${smsList.TYPE == 'SMS'}">결과 수신</label>
                        <label th:case="2" th:if="${smsList.TYPE == 'MMS'}">전송 완료</label>
                        <label th:case="3">결과수신</label>
                        <label th:case="">없음</label>
                    </td>
                    <td><fmt:formatDate pattern="yyyy-MM-dd HH:mm:ss" th:text="${smsList.REQDATE }" /></td>
                    
                    <td th:if="${smsList.PHONE.length} ge 11">
                        <span th:text="${smsList.PHONE.substring(0,3)}"></span> - 
                        <span th:text="${smsList.PHONE.substring(3,7)}"></span> - 
                        <span th:text="${smsList.PHONE.substring(7,11)}"></span>
                    </td>
                    <td th:if="${smsList.PHONE.length} lt 11">
                        <span th:text="${smsList.PHONE.substring(0,3) == '010' ? smsList.PHONE.substring(0,3) : smsList.PHONE.substring(0,2)}"></span> - 
                        <span th:text="${smsList.PHONE.substring(0,3) == '010' ? smsList.PHONE.substring(3,6) : smsList.PHONE.substring(2,6)}"></span> -
                        <span th:text="${smsList.PHONE.substring(6,10)}"></span>
                    </td>
                    <td th:utext="${smsList.MSG}"></td>
                    <!--<td>${fn:replace(fn:escapeXml(sms.msg), newLineChar, "<br />")}</td> -->
                </tr>
            </tbody>
        </table>
        
        <!-- <th:block th:include="/common/pages"></th:block> -->
        <table class="noticeTbl settingSeries">
            <thead>
            <tr>
                <th>
                    <div class="paginate">
                    <a href="javascript:goPage(0)" class="first">처음 페이지</a>
                    <a href="javascript:goPage(0)" class="prev">이전 페이지</a>
                    <span>
                        <a href="javascript:goPage(0)">0</a>
                    </span>
                    <a href="javascript:goPage(0)" class="next">다음 페이지</a>
                    <a href="javascript:goPage(0)" class="last">마지막 페이지</a>
                    </div>
                </th>
            </tr>
            </thead>
        </table>
        
    </th:block>
</html>